# Nixpacks Configuration untuk FTS Backend API
# Optimal untuk TypeScript + Prisma + Node.js project

[phases.setup]
nixpacksPlan = 'nodejs_18'

# Install phase - install ALL dependencies (termasuk devDependencies untuk build)
[phases.install]
nixpacksPlan = 'nodejs_18'
# Install semua dependencies untuk build process
# TypeScript dan dev tools diperlukan untuk compile
cmd = 'npm ci'

# Build phase - generate Prisma Client, run migrations, build TypeScript
[phases.build]
nixpacksPlan = 'nodejs_18'
# Sequential build commands:
# 1. Generate Prisma Client dengan DATABASE_URL production
# 2. Run database migrations (safe untuk production)
# 3. Build TypeScript ke JavaScript
cmd = 'npx prisma generate && npx prisma migrate deploy && npm run build:ts'
# Build harus selesai setelah install selesai
dependsOn = ['install']

# Start phase untuk production
[phases.start]
nixpacksPlan = 'nodejs_18'
# Start command yang sudah ada di package.json
cmd = 'npm start'
# Start harus selesai setelah build selesai
dependsOn = ['build']
